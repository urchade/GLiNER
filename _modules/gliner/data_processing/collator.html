<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>gliner.data_processing.collator - Home 0.2.24 documentation</title><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=d140fbf8" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="gliner.data_processing.collator"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../index.html">
      
      
      <strong>Home</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction to ðŸ‘‘ GLiNER</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../instalation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configs.html">Components &amp; Configs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architectures.html">Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../convert_to_onnx.html">ONNX Export &amp; Deployment</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.model.html">gliner.model module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.config.html">gliner.config module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.training.html">gliner.training package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.training.trainer.html">gliner.training.trainer module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.modeling.html">gliner.modeling package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.multitask.html">gliner.modeling.multitask package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gliner.modeling.multitask.relations_layers.html">gliner.modeling.multitask.relations_layers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gliner.modeling.multitask.triples_layers.html">gliner.modeling.multitask.triples_layers module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.base.html">gliner.modeling.base module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.decoder.html">gliner.modeling.decoder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.encoder.html">gliner.modeling.encoder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.layers.html">gliner.modeling.layers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.loss_functions.html">gliner.modeling.loss_functions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.outputs.html">gliner.modeling.outputs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.scorers.html">gliner.modeling.scorers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.span_rep.html">gliner.modeling.span_rep module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.modeling.utils.html">gliner.modeling.utils module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.data_processing.html">gliner.data_processing package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.data_processing.collator.html">gliner.data_processing.collator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.data_processing.processor.html">gliner.data_processing.processor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.data_processing.tokenizer.html">gliner.data_processing.tokenizer module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.data_processing.utils.html">gliner.data_processing.utils module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.evaluation.html">gliner.evaluation package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.evaluation.evaluate_ner.html">gliner.evaluation.evaluate_ner module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.evaluation.evaluator.html">gliner.evaluation.evaluator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.evaluation.utils.html">gliner.evaluation.utils module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.onnx.html">gliner.onnx package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.onnx.model.html">gliner.onnx.model module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.decoding.html">gliner.decoding package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.decoding.trie.html">gliner.decoding.trie package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gliner.decoding.trie.labels_trie.html">gliner.decoding.trie.labels_trie module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/gliner.decoding.trie.python_labels_trie.html">gliner.decoding.trie.python_labels_trie module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.decoding.decoder.html">gliner.decoding.decoder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/gliner.decoding.utils.html">gliner.decoding.utils module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gliner.utils.html">gliner.utils module</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">Home</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">gliner.data_processing.collator</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for gliner.data_processing.collator</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
</span><span data-line="3">
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">.processor</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="5">    <span class="n">BaseProcessor</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">BiEncoderSpanProcessor</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">BiEncoderTokenProcessor</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">UniEncoderSpanProcessor</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">UniEncoderTokenProcessor</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">UniEncoderSpanDecoderProcessor</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">RelationExtractionSpanProcessor</span><span class="p">,</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14">
<div class="viewcode-block" id="BaseDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BaseDataCollator">[docs]</a>
</span><span data-line="15"><span class="k">class</span><span class="w"> </span><span class="nc">BaseDataCollator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span data-line="16"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="17"><span class="sd">    Abstract base class for all data collators.</span>
</span><span data-line="18">
</span><span data-line="19"><span class="sd">    Provides common functionality for collating batches and preparing model inputs.</span>
</span><span data-line="20"><span class="sd">    Subclasses should implement processor-specific logic and field handling.</span>
</span><span data-line="21"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="22">
<div class="viewcode-block" id="BaseDataCollator.__init__">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BaseDataCollator.__init__">[docs]</a>
</span><span data-line="23">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="24">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="25">        <span class="n">config</span><span class="p">,</span>
</span><span data-line="26">        <span class="n">data_processor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseProcessor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="27">        <span class="n">return_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="28">        <span class="n">return_id_to_classes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="29">        <span class="n">return_entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="30">        <span class="n">prepare_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="31">    <span class="p">):</span>
</span><span data-line="32"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="33"><span class="sd">        Initialize the base data collator.</span>
</span><span data-line="34">
</span><span data-line="35"><span class="sd">        Args:</span>
</span><span data-line="36"><span class="sd">            config: Configuration object containing model/training parameters.</span>
</span><span data-line="37"><span class="sd">            data_processor: Processor instance for handling data transformations.</span>
</span><span data-line="38"><span class="sd">                If None, subclass should provide a default processor.</span>
</span><span data-line="39"><span class="sd">            return_tokens: Whether to include tokenized text in output.</span>
</span><span data-line="40"><span class="sd">            return_id_to_classes: Whether to include class ID to name mappings.</span>
</span><span data-line="41"><span class="sd">            return_entities: Whether to include entity annotations.</span>
</span><span data-line="42"><span class="sd">            prepare_labels: Whether to prepare labels for training.</span>
</span><span data-line="43"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="44">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span data-line="45">        <span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span> <span class="o">=</span> <span class="n">data_processor</span>
</span><span data-line="46">        <span class="bp">self</span><span class="o">.</span><span class="n">return_tokens</span> <span class="o">=</span> <span class="n">return_tokens</span>
</span><span data-line="47">        <span class="bp">self</span><span class="o">.</span><span class="n">return_id_to_classes</span> <span class="o">=</span> <span class="n">return_id_to_classes</span>
</span><span data-line="48">        <span class="bp">self</span><span class="o">.</span><span class="n">return_entities</span> <span class="o">=</span> <span class="n">return_entities</span>
</span><span data-line="49">        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_labels</span> <span class="o">=</span> <span class="n">prepare_labels</span></div>

</span><span data-line="50">
<div class="viewcode-block" id="BaseDataCollator.collate_batch">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BaseDataCollator.collate_batch">[docs]</a>
</span><span data-line="51">    <span class="k">def</span><span class="w"> </span><span class="nf">collate_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="52"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="53"><span class="sd">        Collate raw input examples into a batch.</span>
</span><span data-line="54">
</span><span data-line="55"><span class="sd">        Args:</span>
</span><span data-line="56"><span class="sd">            input_x: List of raw input examples.</span>
</span><span data-line="57"><span class="sd">            **kwargs: Additional arguments passed to the processor&#39;s collate_raw_batch.</span>
</span><span data-line="58">
</span><span data-line="59"><span class="sd">        Returns:</span>
</span><span data-line="60"><span class="sd">            Dict containing collated raw batch data.</span>
</span><span data-line="61"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="62">        <span class="n">raw_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="o">.</span><span class="n">collate_raw_batch</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="63">        <span class="k">return</span> <span class="n">raw_batch</span></div>

</span><span data-line="64">
<div class="viewcode-block" id="BaseDataCollator.collate_function">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BaseDataCollator.collate_function">[docs]</a>
</span><span data-line="65">    <span class="k">def</span><span class="w"> </span><span class="nf">collate_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="66"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="67"><span class="sd">        Transform raw batch into model input format.</span>
</span><span data-line="68">
</span><span data-line="69"><span class="sd">        Args:</span>
</span><span data-line="70"><span class="sd">            raw_batch: Raw collated batch from collate_batch.</span>
</span><span data-line="71"><span class="sd">            **kwargs: Additional arguments passed to the processor&#39;s collate_fn.</span>
</span><span data-line="72">
</span><span data-line="73"><span class="sd">        Returns:</span>
</span><span data-line="74"><span class="sd">            Dict containing model-ready inputs.</span>
</span><span data-line="75"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="76">        <span class="n">model_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="o">.</span><span class="n">collate_fn</span><span class="p">(</span><span class="n">raw_batch</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="77">        <span class="k">return</span> <span class="n">model_input</span></div>

</span><span data-line="78">
</span><span data-line="79">    <span class="k">def</span><span class="w"> </span><span class="nf">_add_conditional_returns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">raw_batch</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="80"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="81"><span class="sd">        Add optional fields to model input based on collator configuration.</span>
</span><span data-line="82">
</span><span data-line="83"><span class="sd">        Args:</span>
</span><span data-line="84"><span class="sd">            model_input: Model input dictionary to update in-place.</span>
</span><span data-line="85"><span class="sd">            raw_batch: Raw batch containing optional fields.</span>
</span><span data-line="86"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="87">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_tokens</span><span class="p">:</span>
</span><span data-line="88">            <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">)</span>
</span><span data-line="89">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_id_to_classes</span><span class="p">:</span>
</span><span data-line="90">            <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;id_to_classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id_to_classes&quot;</span><span class="p">)</span>
</span><span data-line="91">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_entities</span><span class="p">:</span>
</span><span data-line="92">            <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;entities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">)</span>
</span><span data-line="93">
</span><span data-line="94">    <span class="nd">@staticmethod</span>
</span><span data-line="95">    <span class="k">def</span><span class="w"> </span><span class="nf">_filter_none_values</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="96"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="97"><span class="sd">        Remove entries with None values from dictionary.</span>
</span><span data-line="98">
</span><span data-line="99"><span class="sd">        Args:</span>
</span><span data-line="100"><span class="sd">            data: Dictionary potentially containing None values.</span>
</span><span data-line="101">
</span><span data-line="102"><span class="sd">        Returns:</span>
</span><span data-line="103"><span class="sd">            Dictionary with all None values filtered out.</span>
</span><span data-line="104"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="105">        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span><span data-line="106">
</span><span data-line="107">    <span class="nd">@staticmethod</span>
</span><span data-line="108">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_id_to_classes_for_sample</span><span class="p">(</span>
</span><span data-line="109">        <span class="n">id_to_classes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span> <span class="n">sample_idx</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="110">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span data-line="111"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="112"><span class="sd">        Get id_to_classes mapping for a specific sample.</span>
</span><span data-line="113">
</span><span data-line="114"><span class="sd">        Args:</span>
</span><span data-line="115"><span class="sd">            id_to_classes: Either a single mapping shared across all samples</span>
</span><span data-line="116"><span class="sd">                or per-sample mappings.</span>
</span><span data-line="117"><span class="sd">            sample_idx: Index of the sample in the batch.</span>
</span><span data-line="118">
</span><span data-line="119"><span class="sd">        Returns:</span>
</span><span data-line="120"><span class="sd">            Mapping from class IDs to class names for this sample.</span>
</span><span data-line="121"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="122">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_to_classes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span data-line="123">            <span class="k">return</span> <span class="n">id_to_classes</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>
</span><span data-line="124">        <span class="k">return</span> <span class="n">id_to_classes</span>
</span><span data-line="125">
</span><span data-line="126">    <span class="nd">@abstractmethod</span>
</span><span data-line="127">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="128"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="129"><span class="sd">        Main collation method to be implemented by subclasses.</span>
</span><span data-line="130">
</span><span data-line="131"><span class="sd">        Args:</span>
</span><span data-line="132"><span class="sd">            input_x: List of raw input examples.</span>
</span><span data-line="133"><span class="sd">            **kwargs: Additional collation arguments.</span>
</span><span data-line="134">
</span><span data-line="135"><span class="sd">        Returns:</span>
</span><span data-line="136"><span class="sd">            Collated and processed batch ready for model input.</span>
</span><span data-line="137"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="138">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Subclasses must implement __call__ method&quot;</span><span class="p">)</span></div>

</span><span data-line="139">
</span><span data-line="140">
<div class="viewcode-block" id="BaseSpanCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BaseSpanCollator">[docs]</a>
</span><span data-line="141"><span class="k">class</span><span class="w"> </span><span class="nc">BaseSpanCollator</span><span class="p">(</span><span class="n">BaseDataCollator</span><span class="p">):</span>
</span><span data-line="142"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="143"><span class="sd">    Base collator for span-based processors.</span>
</span><span data-line="144">
</span><span data-line="145"><span class="sd">    Provides common logic for handling span indices, span masks, and span labels.</span>
</span><span data-line="146"><span class="sd">    Used by all span-level NER/RE models.</span>
</span><span data-line="147"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="148">
</span><span data-line="149">    <span class="k">def</span><span class="w"> </span><span class="nf">_add_span_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">raw_batch</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="150"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="151"><span class="sd">        Add span-specific fields to model input.</span>
</span><span data-line="152">
</span><span data-line="153"><span class="sd">        Args:</span>
</span><span data-line="154"><span class="sd">            model_input: Model input dictionary to update in-place.</span>
</span><span data-line="155"><span class="sd">            raw_batch: Raw batch containing span-related fields.</span>
</span><span data-line="156"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="157">        <span class="n">model_input</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span data-line="158">            <span class="p">{</span>
</span><span data-line="159">                <span class="s2">&quot;span_idx&quot;</span><span class="p">:</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;span_idx&quot;</span><span class="p">),</span>
</span><span data-line="160">                <span class="s2">&quot;span_mask&quot;</span><span class="p">:</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;span_mask&quot;</span><span class="p">),</span>
</span><span data-line="161">                <span class="s2">&quot;text_lengths&quot;</span><span class="p">:</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seq_length&quot;</span><span class="p">),</span>
</span><span data-line="162">            <span class="p">}</span>
</span><span data-line="163">        <span class="p">)</span></div>

</span><span data-line="164">
</span><span data-line="165">
<div class="viewcode-block" id="BaseTokenCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BaseTokenCollator">[docs]</a>
</span><span data-line="166"><span class="k">class</span><span class="w"> </span><span class="nc">BaseTokenCollator</span><span class="p">(</span><span class="n">BaseDataCollator</span><span class="p">):</span>
</span><span data-line="167"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="168"><span class="sd">    Base collator for token-based processors.</span>
</span><span data-line="169">
</span><span data-line="170"><span class="sd">    Provides common logic for handling token-level annotations and entity IDs.</span>
</span><span data-line="171"><span class="sd">    Used by all token-level NER models.</span>
</span><span data-line="172"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="173">
</span><span data-line="174">    <span class="k">def</span><span class="w"> </span><span class="nf">_add_token_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">raw_batch</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="175"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="176"><span class="sd">        Add token-specific fields to model input.</span>
</span><span data-line="177">
</span><span data-line="178"><span class="sd">        Args:</span>
</span><span data-line="179"><span class="sd">            model_input: Model input dictionary to update in-place.</span>
</span><span data-line="180"><span class="sd">            raw_batch: Raw batch containing token-related fields.</span>
</span><span data-line="181"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="182">        <span class="n">model_input</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;text_lengths&quot;</span><span class="p">:</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seq_length&quot;</span><span class="p">),</span> <span class="s2">&quot;entities_id&quot;</span><span class="p">:</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities_id&quot;</span><span class="p">)})</span></div>

</span><span data-line="183">
</span><span data-line="184">
<div class="viewcode-block" id="SpanDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.SpanDataCollator">[docs]</a>
</span><span data-line="185"><span class="k">class</span><span class="w"> </span><span class="nc">SpanDataCollator</span><span class="p">(</span><span class="n">BaseSpanCollator</span><span class="p">):</span>
</span><span data-line="186"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="187"><span class="sd">    Unified data collator for all span-based processors.</span>
</span><span data-line="188">
</span><span data-line="189"><span class="sd">    Handles span-based NER with various architectures:</span>
</span><span data-line="190"><span class="sd">    - UniEncoder: Single encoder with span classification</span>
</span><span data-line="191"><span class="sd">    - BiEncoder: Separate encoders for text and entity types</span>
</span><span data-line="192"><span class="sd">    - EncoderDecoder: Generative entity typing with decoder</span>
</span><span data-line="193">
</span><span data-line="194"><span class="sd">    Automatically adapts behavior based on processor type.</span>
</span><span data-line="195">
</span><span data-line="196"><span class="sd">    Required Processors: UniEncoderSpanProcessor, BiEncoderSpanProcessor,</span>
</span><span data-line="197"><span class="sd">                         or UniEncoderSpanDecoderProcessor</span>
</span><span data-line="198"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="199">
<div class="viewcode-block" id="SpanDataCollator.__init__">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.SpanDataCollator.__init__">[docs]</a>
</span><span data-line="200">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="201">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="202">        <span class="n">config</span><span class="p">,</span>
</span><span data-line="203">        <span class="n">data_processor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="204">            <span class="n">Union</span><span class="p">[</span><span class="n">UniEncoderSpanProcessor</span><span class="p">,</span> <span class="n">BiEncoderSpanProcessor</span><span class="p">,</span> <span class="n">UniEncoderSpanDecoderProcessor</span><span class="p">]</span>
</span><span data-line="205">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="206">        <span class="n">return_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="207">        <span class="n">return_id_to_classes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="208">        <span class="n">return_entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="209">        <span class="n">prepare_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="210">        <span class="n">prepare_entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="211">    <span class="p">):</span>
</span><span data-line="212"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="213"><span class="sd">        Initialize unified span collator.</span>
</span><span data-line="214">
</span><span data-line="215"><span class="sd">        Args:</span>
</span><span data-line="216"><span class="sd">            config: Configuration object.</span>
</span><span data-line="217"><span class="sd">            data_processor: Span processor instance (Uni/Bi/EncoderDecoder).</span>
</span><span data-line="218"><span class="sd">            return_tokens: Whether to return tokenized text.</span>
</span><span data-line="219"><span class="sd">            return_id_to_classes: Whether to return class mappings.</span>
</span><span data-line="220"><span class="sd">            return_entities: Whether to return entity annotations.</span>
</span><span data-line="221"><span class="sd">            prepare_labels: Whether to prepare training labels.</span>
</span><span data-line="222"><span class="sd">            prepare_entities: Whether to encode entity types (BiEncoder only).</span>
</span><span data-line="223"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="224">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data_processor</span><span class="p">,</span> <span class="n">return_tokens</span><span class="p">,</span> <span class="n">return_id_to_classes</span><span class="p">,</span> <span class="n">return_entities</span><span class="p">,</span> <span class="n">prepare_labels</span><span class="p">)</span>
</span><span data-line="225">        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_entities</span> <span class="o">=</span> <span class="n">prepare_entities</span></div>

</span><span data-line="226">
</span><span data-line="227">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="228">        <span class="bp">self</span><span class="p">,</span> <span class="n">input_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">entity_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span data-line="229">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="230"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="231"><span class="sd">        Collate batch for span-based model.</span>
</span><span data-line="232">
</span><span data-line="233"><span class="sd">        Args:</span>
</span><span data-line="234"><span class="sd">            input_x: List of input examples with &#39;tokenized_text&#39; and &#39;ner&#39; fields.</span>
</span><span data-line="235"><span class="sd">            entity_types: Optional entity type specifications.</span>
</span><span data-line="236"><span class="sd">            **kwargs: Additional arguments for collation.</span>
</span><span data-line="237">
</span><span data-line="238"><span class="sd">        Returns:</span>
</span><span data-line="239"><span class="sd">            Model-ready batch dictionary adapted to processor type.</span>
</span><span data-line="240"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="241">        <span class="n">raw_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_batch</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="242">
</span><span data-line="243">        <span class="c1"># Build collate_fn kwargs based on processor type</span>
</span><span data-line="244">        <span class="n">collate_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prepare_labels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
</span><span data-line="245">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="p">,</span> <span class="n">BiEncoderSpanProcessor</span><span class="p">):</span>
</span><span data-line="246">            <span class="n">collate_kwargs</span><span class="p">[</span><span class="s2">&quot;prepare_entities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_entities</span>
</span><span data-line="247">
</span><span data-line="248">        <span class="n">model_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_function</span><span class="p">(</span><span class="n">raw_batch</span><span class="p">,</span> <span class="o">**</span><span class="n">collate_kwargs</span><span class="p">)</span>
</span><span data-line="249">
</span><span data-line="250">        <span class="bp">self</span><span class="o">.</span><span class="n">_add_span_fields</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">)</span>
</span><span data-line="251">
</span><span data-line="252">        <span class="c1"># Add decoder-specific fields for EncoderDecoder models</span>
</span><span data-line="253">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="p">,</span> <span class="n">UniEncoderSpanDecoderProcessor</span><span class="p">):</span>
</span><span data-line="254">            <span class="n">decoder_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;decoder_labels_ids&quot;</span><span class="p">,</span> <span class="s2">&quot;decoder_labels_mask&quot;</span><span class="p">,</span> <span class="s2">&quot;decoder_labels&quot;</span><span class="p">]</span>
</span><span data-line="255">            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">decoder_fields</span><span class="p">:</span>
</span><span data-line="256">                <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">:</span>
</span><span data-line="257">                    <span class="n">model_input</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span><span data-line="258">
</span><span data-line="259">        <span class="bp">self</span><span class="o">.</span><span class="n">_add_conditional_returns</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">)</span>
</span><span data-line="260">
</span><span data-line="261">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_none_values</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span></div>

</span><span data-line="262">
</span><span data-line="263">
<div class="viewcode-block" id="TokenDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.TokenDataCollator">[docs]</a>
</span><span data-line="264"><span class="k">class</span><span class="w"> </span><span class="nc">TokenDataCollator</span><span class="p">(</span><span class="n">BaseTokenCollator</span><span class="p">):</span>
</span><span data-line="265"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="266"><span class="sd">    Unified data collator for all token-based processors.</span>
</span><span data-line="267">
</span><span data-line="268"><span class="sd">    Handles token-level NER with various architectures:</span>
</span><span data-line="269"><span class="sd">    - UniEncoder: Single encoder with BIO/BIOES tagging</span>
</span><span data-line="270"><span class="sd">    - BiEncoder: Separate encoders for text and entity types</span>
</span><span data-line="271">
</span><span data-line="272"><span class="sd">    Automatically adapts behavior based on processor type.</span>
</span><span data-line="273">
</span><span data-line="274"><span class="sd">    Required Processors: UniEncoderTokenProcessor or BiEncoderTokenProcessor</span>
</span><span data-line="275"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="276">
<div class="viewcode-block" id="TokenDataCollator.__init__">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.TokenDataCollator.__init__">[docs]</a>
</span><span data-line="277">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="278">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="279">        <span class="n">config</span><span class="p">,</span>
</span><span data-line="280">        <span class="n">data_processor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">UniEncoderTokenProcessor</span><span class="p">,</span> <span class="n">BiEncoderTokenProcessor</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="281">        <span class="n">return_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="282">        <span class="n">return_id_to_classes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="283">        <span class="n">return_entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="284">        <span class="n">prepare_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="285">        <span class="n">prepare_entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="286">    <span class="p">):</span>
</span><span data-line="287"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="288"><span class="sd">        Initialize unified token collator.</span>
</span><span data-line="289">
</span><span data-line="290"><span class="sd">        Args:</span>
</span><span data-line="291"><span class="sd">            config: Configuration object.</span>
</span><span data-line="292"><span class="sd">            data_processor: Token processor instance (Uni/Bi).</span>
</span><span data-line="293"><span class="sd">            return_tokens: Whether to return tokenized text.</span>
</span><span data-line="294"><span class="sd">            return_id_to_classes: Whether to return class mappings.</span>
</span><span data-line="295"><span class="sd">            return_entities: Whether to return entity annotations.</span>
</span><span data-line="296"><span class="sd">            prepare_labels: Whether to prepare training labels.</span>
</span><span data-line="297"><span class="sd">            prepare_entities: Whether to encode entity types (BiEncoder only).</span>
</span><span data-line="298"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="299">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data_processor</span><span class="p">,</span> <span class="n">return_tokens</span><span class="p">,</span> <span class="n">return_id_to_classes</span><span class="p">,</span> <span class="n">return_entities</span><span class="p">,</span> <span class="n">prepare_labels</span><span class="p">)</span>
</span><span data-line="300">        <span class="bp">self</span><span class="o">.</span><span class="n">prepare_entities</span> <span class="o">=</span> <span class="n">prepare_entities</span></div>

</span><span data-line="301">
</span><span data-line="302">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="303">        <span class="bp">self</span><span class="p">,</span> <span class="n">input_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">entity_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span data-line="304">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="305"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="306"><span class="sd">        Collate batch for token-based model.</span>
</span><span data-line="307">
</span><span data-line="308"><span class="sd">        Args:</span>
</span><span data-line="309"><span class="sd">            input_x: List of input examples with &#39;tokenized_text&#39; and &#39;ner&#39; fields.</span>
</span><span data-line="310"><span class="sd">            entity_types: Optional entity type specifications.</span>
</span><span data-line="311"><span class="sd">            **kwargs: Additional arguments for collation.</span>
</span><span data-line="312">
</span><span data-line="313"><span class="sd">        Returns:</span>
</span><span data-line="314"><span class="sd">            Model-ready batch with token-level labels adapted to processor type.</span>
</span><span data-line="315"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="316">        <span class="n">raw_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_batch</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="317">
</span><span data-line="318">        <span class="c1"># Build collate_fn kwargs based on processor type</span>
</span><span data-line="319">        <span class="n">collate_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prepare_labels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
</span><span data-line="320">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="p">,</span> <span class="n">BiEncoderTokenProcessor</span><span class="p">):</span>
</span><span data-line="321">            <span class="n">collate_kwargs</span><span class="p">[</span><span class="s2">&quot;prepare_entities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_entities</span>
</span><span data-line="322">
</span><span data-line="323">        <span class="n">model_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_function</span><span class="p">(</span><span class="n">raw_batch</span><span class="p">,</span> <span class="o">**</span><span class="n">collate_kwargs</span><span class="p">)</span>
</span><span data-line="324">
</span><span data-line="325">        <span class="bp">self</span><span class="o">.</span><span class="n">_add_token_fields</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">)</span>
</span><span data-line="326">        <span class="bp">self</span><span class="o">.</span><span class="n">_add_conditional_returns</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">)</span>
</span><span data-line="327">
</span><span data-line="328">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_none_values</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span></div>

</span><span data-line="329">
</span><span data-line="330">
<div class="viewcode-block" id="RelationExtractionSpanDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.RelationExtractionSpanDataCollator">[docs]</a>
</span><span data-line="331"><span class="k">class</span><span class="w"> </span><span class="nc">RelationExtractionSpanDataCollator</span><span class="p">(</span><span class="n">BaseSpanCollator</span><span class="p">):</span>
</span><span data-line="332"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Data collator for RelationExtractionSpanProcessor.</span>
</span><span data-line="333">
</span><span data-line="334"><span class="sd">    Handles joint entity and relation extraction at span level.</span>
</span><span data-line="335"><span class="sd">    Produces both entity labels and relation adjacency matrices.</span>
</span><span data-line="336">
</span><span data-line="337"><span class="sd">    This collator is kept separate due to its unique handling of:</span>
</span><span data-line="338"><span class="sd">    - Relation adjacency matrices</span>
</span><span data-line="339"><span class="sd">    - Dual classification (entities + relations)</span>
</span><span data-line="340"><span class="sd">    - Relation-specific configuration</span>
</span><span data-line="341">
</span><span data-line="342"><span class="sd">    Required Processor: RelationExtractionSpanProcessor</span>
</span><span data-line="343"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="344">
<div class="viewcode-block" id="RelationExtractionSpanDataCollator.__init__">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.RelationExtractionSpanDataCollator.__init__">[docs]</a>
</span><span data-line="345">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="346">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="347">        <span class="n">config</span><span class="p">,</span>
</span><span data-line="348">        <span class="n">data_processor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RelationExtractionSpanProcessor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="349">        <span class="n">return_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="350">        <span class="n">return_id_to_classes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="351">        <span class="n">return_entities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="352">        <span class="n">return_rel_id_to_classes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="353">        <span class="n">return_relations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="354">        <span class="n">prepare_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="355">    <span class="p">):</span>
</span><span data-line="356"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="357"><span class="sd">        Initialize RelationExtraction span collator.</span>
</span><span data-line="358">
</span><span data-line="359"><span class="sd">        Args:</span>
</span><span data-line="360"><span class="sd">            config: Configuration object.</span>
</span><span data-line="361"><span class="sd">            data_processor: RelationExtractionSpanProcessor instance.</span>
</span><span data-line="362"><span class="sd">            return_tokens: Whether to return tokenized text.</span>
</span><span data-line="363"><span class="sd">            return_id_to_classes: Whether to return entity class mappings.</span>
</span><span data-line="364"><span class="sd">            return_entities: Whether to return entity annotations.</span>
</span><span data-line="365"><span class="sd">            return_rel_id_to_classes: Whether to return relation class mappings.</span>
</span><span data-line="366"><span class="sd">            return_relations: Whether to return relation annotations.</span>
</span><span data-line="367"><span class="sd">            prepare_labels: Whether to prepare training labels.</span>
</span><span data-line="368"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="369">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data_processor</span><span class="p">,</span> <span class="n">return_tokens</span><span class="p">,</span> <span class="n">return_id_to_classes</span><span class="p">,</span> <span class="n">return_entities</span><span class="p">,</span> <span class="n">prepare_labels</span><span class="p">)</span>
</span><span data-line="370">        <span class="bp">self</span><span class="o">.</span><span class="n">return_rel_id_to_classes</span> <span class="o">=</span> <span class="n">return_rel_id_to_classes</span>
</span><span data-line="371">        <span class="bp">self</span><span class="o">.</span><span class="n">return_relations</span> <span class="o">=</span> <span class="n">return_relations</span></div>

</span><span data-line="372">
<div class="viewcode-block" id="RelationExtractionSpanDataCollator.collate_batch">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.RelationExtractionSpanDataCollator.collate_batch">[docs]</a>
</span><span data-line="373">    <span class="k">def</span><span class="w"> </span><span class="nf">collate_batch</span><span class="p">(</span>
</span><span data-line="374">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="375">        <span class="n">input_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span data-line="376">        <span class="n">entity_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="377">        <span class="n">relation_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="378">        <span class="n">ner_negatives</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="379">        <span class="n">rel_negatives</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="380">        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="381">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="382"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="383"><span class="sd">        Collate raw batch data for relation extraction.</span>
</span><span data-line="384">
</span><span data-line="385"><span class="sd">        Args:</span>
</span><span data-line="386"><span class="sd">            input_x: List of input examples.</span>
</span><span data-line="387"><span class="sd">            entity_types: Optional entity type specifications.</span>
</span><span data-line="388"><span class="sd">            relation_types: Optional relation type specifications.</span>
</span><span data-line="389"><span class="sd">            ner_negatives: Optional negative entity types for sampling.</span>
</span><span data-line="390"><span class="sd">            rel_negatives: Optional negative relation types for sampling.</span>
</span><span data-line="391"><span class="sd">            **kwargs: Additional arguments.</span>
</span><span data-line="392">
</span><span data-line="393"><span class="sd">        Returns:</span>
</span><span data-line="394"><span class="sd">            Collated raw batch with entity and relation information.</span>
</span><span data-line="395"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="396">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="p">:</span>
</span><span data-line="397">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data_processor must be provided for collate_batch&quot;</span><span class="p">)</span>
</span><span data-line="398">
</span><span data-line="399">        <span class="c1"># Call processor&#39;s collate_raw_batch with both entity and relation types</span>
</span><span data-line="400">        <span class="n">raw_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processor</span><span class="o">.</span><span class="n">collate_raw_batch</span><span class="p">(</span>
</span><span data-line="401">            <span class="n">input_x</span><span class="p">,</span>
</span><span data-line="402">            <span class="n">entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">,</span>
</span><span data-line="403">            <span class="n">relation_types</span><span class="o">=</span><span class="n">relation_types</span><span class="p">,</span>
</span><span data-line="404">            <span class="n">ner_negatives</span><span class="o">=</span><span class="n">ner_negatives</span><span class="p">,</span>
</span><span data-line="405">            <span class="n">rel_negatives</span><span class="o">=</span><span class="n">rel_negatives</span><span class="p">,</span>
</span><span data-line="406">            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ner&quot;</span><span class="p">,</span>
</span><span data-line="407">            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="408">        <span class="p">)</span>
</span><span data-line="409">
</span><span data-line="410">        <span class="k">return</span> <span class="n">raw_batch</span></div>

</span><span data-line="411">
</span><span data-line="412">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span data-line="413">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="414">        <span class="n">input_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span data-line="415">        <span class="n">entity_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="416">        <span class="n">relation_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="417">        <span class="n">ner_negatives</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="418">        <span class="n">rel_negatives</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="419">        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="420">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="421"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="422"><span class="sd">        Collate batch for RelationExtraction span model.</span>
</span><span data-line="423">
</span><span data-line="424"><span class="sd">        Args:</span>
</span><span data-line="425"><span class="sd">            input_x: List of input examples with &#39;tokenized_text&#39;, &#39;ner&#39;,</span>
</span><span data-line="426"><span class="sd">                and &#39;relations&#39; fields.</span>
</span><span data-line="427"><span class="sd">            entity_types: Optional entity type specifications.</span>
</span><span data-line="428"><span class="sd">            relation_types: Optional relation type specifications.</span>
</span><span data-line="429"><span class="sd">            ner_negatives: Optional negative entity types for sampling.</span>
</span><span data-line="430"><span class="sd">            rel_negatives: Optional negative relation types for sampling.</span>
</span><span data-line="431"><span class="sd">            **kwargs: Additional arguments for collation.</span>
</span><span data-line="432">
</span><span data-line="433"><span class="sd">        Returns:</span>
</span><span data-line="434"><span class="sd">            Model-ready batch with entity spans, relation adjacency matrix,</span>
</span><span data-line="435"><span class="sd">            and relation classification targets.</span>
</span><span data-line="436"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="437">        <span class="c1"># Collate raw batch with both entity and relation types</span>
</span><span data-line="438">        <span class="n">raw_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_batch</span><span class="p">(</span>
</span><span data-line="439">            <span class="n">input_x</span><span class="p">,</span>
</span><span data-line="440">            <span class="n">entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">,</span>
</span><span data-line="441">            <span class="n">relation_types</span><span class="o">=</span><span class="n">relation_types</span><span class="p">,</span>
</span><span data-line="442">            <span class="n">ner_negatives</span><span class="o">=</span><span class="n">ner_negatives</span><span class="p">,</span>
</span><span data-line="443">            <span class="n">rel_negatives</span><span class="o">=</span><span class="n">rel_negatives</span><span class="p">,</span>
</span><span data-line="444">            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="445">        <span class="p">)</span>
</span><span data-line="446">
</span><span data-line="447">        <span class="n">model_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_function</span><span class="p">(</span>
</span><span data-line="448">            <span class="n">raw_batch</span><span class="p">,</span> <span class="n">prepare_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepare_labels</span><span class="p">,</span> <span class="n">prepare_entities</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span data-line="449">        <span class="p">)</span>
</span><span data-line="450">
</span><span data-line="451">        <span class="bp">self</span><span class="o">.</span><span class="n">_add_span_fields</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">)</span>
</span><span data-line="452">
</span><span data-line="453">        <span class="bp">self</span><span class="o">.</span><span class="n">_add_conditional_returns</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">raw_batch</span><span class="p">)</span>
</span><span data-line="454">
</span><span data-line="455">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_rel_id_to_classes</span><span class="p">:</span>
</span><span data-line="456">            <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;rel_id_to_classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel_id_to_classes&quot;</span><span class="p">)</span>
</span><span data-line="457">
</span><span data-line="458">        <span class="k">if</span> <span class="s2">&quot;rel_class_to_ids&quot;</span> <span class="ow">in</span> <span class="n">raw_batch</span><span class="p">:</span>
</span><span data-line="459">            <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;rel_class_to_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_batch</span><span class="p">[</span><span class="s2">&quot;rel_class_to_ids&quot;</span><span class="p">]</span>
</span><span data-line="460">
</span><span data-line="461">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_relations</span><span class="p">:</span>
</span><span data-line="462">            <span class="n">model_input</span><span class="p">[</span><span class="s2">&quot;relations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relations&quot;</span><span class="p">)</span>
</span><span data-line="463">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_none_values</span><span class="p">(</span><span class="n">model_input</span><span class="p">)</span>
</span><span data-line="464">
</span><span data-line="465">    <span class="k">def</span><span class="w"> </span><span class="nf">_filter_none_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="466"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="467"><span class="sd">        Remove None values from batch dictionary.</span>
</span><span data-line="468">
</span><span data-line="469"><span class="sd">        Args:</span>
</span><span data-line="470"><span class="sd">            batch_dict: Dictionary potentially containing None values.</span>
</span><span data-line="471">
</span><span data-line="472"><span class="sd">        Returns:</span>
</span><span data-line="473"><span class="sd">            Dictionary with None values removed.</span>
</span><span data-line="474"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="475">        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span></div>

</span><span data-line="476">
</span><span data-line="477">
<div class="viewcode-block" id="RelationExtractionTokenDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.RelationExtractionTokenDataCollator">[docs]</a>
</span><span data-line="478"><span class="k">class</span><span class="w"> </span><span class="nc">RelationExtractionTokenDataCollator</span><span class="p">(</span><span class="n">RelationExtractionSpanDataCollator</span><span class="p">):</span>
</span><span data-line="479"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Data collator for RelationExtractionTokenProcessor.</span>
</span><span data-line="480">
</span><span data-line="481"><span class="sd">    Handles joint entity and relation extraction at token level.</span>
</span><span data-line="482"><span class="sd">    Produces both entity labels and relation adjacency matrices.</span>
</span><span data-line="483">
</span><span data-line="484"><span class="sd">    Required Processor: RelationExtractionTokenProcessor</span>
</span><span data-line="485"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="486">
</span><span data-line="487">    <span class="k">pass</span></div>

</span><span data-line="488">
</span><span data-line="489">
<div class="viewcode-block" id="UniEncoderSpanDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.UniEncoderSpanDataCollator">[docs]</a>
</span><span data-line="490"><span class="k">class</span><span class="w"> </span><span class="nc">UniEncoderSpanDataCollator</span><span class="p">(</span><span class="n">SpanDataCollator</span><span class="p">):</span>
</span><span data-line="491"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="492"><span class="sd">    Backward compatibility alias for SpanDataCollator with UniEncoderSpanProcessor.</span>
</span><span data-line="493">
</span><span data-line="494"><span class="sd">    Use SpanDataCollator directly for new code.</span>
</span><span data-line="495"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="496">
</span><span data-line="497">    <span class="k">pass</span></div>

</span><span data-line="498">
</span><span data-line="499">
<div class="viewcode-block" id="BiEncoderSpanDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BiEncoderSpanDataCollator">[docs]</a>
</span><span data-line="500"><span class="k">class</span><span class="w"> </span><span class="nc">BiEncoderSpanDataCollator</span><span class="p">(</span><span class="n">SpanDataCollator</span><span class="p">):</span>
</span><span data-line="501"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="502"><span class="sd">    Backward compatibility alias for SpanDataCollator with BiEncoderSpanProcessor.</span>
</span><span data-line="503">
</span><span data-line="504"><span class="sd">    Use SpanDataCollator directly for new code.</span>
</span><span data-line="505"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="506">
</span><span data-line="507">    <span class="k">pass</span></div>

</span><span data-line="508">
</span><span data-line="509">
<div class="viewcode-block" id="UniEncoderSpanDecoderDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.UniEncoderSpanDecoderDataCollator">[docs]</a>
</span><span data-line="510"><span class="k">class</span><span class="w"> </span><span class="nc">UniEncoderSpanDecoderDataCollator</span><span class="p">(</span><span class="n">SpanDataCollator</span><span class="p">):</span>
</span><span data-line="511"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="512"><span class="sd">    Backward compatibility alias for SpanDataCollator with EncoderDecoderSpanProcessor.</span>
</span><span data-line="513">
</span><span data-line="514"><span class="sd">    Use SpanDataCollator directly for new code.</span>
</span><span data-line="515"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="516">
</span><span data-line="517">    <span class="k">pass</span></div>

</span><span data-line="518">
</span><span data-line="519">
<div class="viewcode-block" id="UniEncoderTokenDecoderDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.UniEncoderTokenDecoderDataCollator">[docs]</a>
</span><span data-line="520"><span class="k">class</span><span class="w"> </span><span class="nc">UniEncoderTokenDecoderDataCollator</span><span class="p">(</span><span class="n">UniEncoderSpanDecoderDataCollator</span><span class="p">):</span>
</span><span data-line="521"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="522"><span class="sd">    Backward compatibility alias for UniEncoderTokenDecoderDataCollator with UniEncoderSpanDecoderDataCollator.</span>
</span><span data-line="523"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="524">
</span><span data-line="525">    <span class="k">pass</span></div>

</span><span data-line="526">
</span><span data-line="527">
<div class="viewcode-block" id="UniEncoderTokenDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.UniEncoderTokenDataCollator">[docs]</a>
</span><span data-line="528"><span class="k">class</span><span class="w"> </span><span class="nc">UniEncoderTokenDataCollator</span><span class="p">(</span><span class="n">TokenDataCollator</span><span class="p">):</span>
</span><span data-line="529"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="530"><span class="sd">    Backward compatibility alias for TokenDataCollator with UniEncoderTokenProcessor.</span>
</span><span data-line="531">
</span><span data-line="532"><span class="sd">    Use TokenDataCollator directly for new code.</span>
</span><span data-line="533"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="534">
</span><span data-line="535">    <span class="k">pass</span></div>

</span><span data-line="536">
</span><span data-line="537">
<div class="viewcode-block" id="BiEncoderTokenDataCollator">
<a class="viewcode-back" href="../../../api/gliner.data_processing.collator.html#gliner.data_processing.collator.BiEncoderTokenDataCollator">[docs]</a>
</span><span data-line="538"><span class="k">class</span><span class="w"> </span><span class="nc">BiEncoderTokenDataCollator</span><span class="p">(</span><span class="n">TokenDataCollator</span><span class="p">):</span>
</span><span data-line="539"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="540"><span class="sd">    Backward compatibility alias for TokenDataCollator with BiEncoderTokenProcessor.</span>
</span><span data-line="541">
</span><span data-line="542"><span class="sd">    Use TokenDataCollator directly for new code.</span>
</span><span data-line="543"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="544">
</span><span data-line="545">    <span class="k">pass</span></div>

</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, GLiNER community</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=dc91f075"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/shibuya.js?v=9b0e4dde"></script></body>
</html>